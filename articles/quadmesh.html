<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quadmesh • quadmesh</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quadmesh">
<meta property="og:description" content="quadmesh">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">quadmesh</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.5.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/quadmesh.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/topography.html">Topography with quadmesh</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hypertidy/quadmesh/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quadmesh</h1>
                        <h4 data-toc-skip class="author">Michael D. Sumner</h4>
            
            <h4 data-toc-skip class="date">2022-08-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hypertidy/quadmesh/blob/HEAD/vignettes/quadmesh.Rmd" class="external-link"><code>vignettes/quadmesh.Rmd</code></a></small>
      <div class="hidden name"><code>quadmesh.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="quadmesh">quadmesh<a class="anchor" aria-label="anchor" href="#quadmesh"></a>
</h2>
<p>Build a “quadmesh” in R.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/quadmesh" class="external-link">quadmesh</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: sp</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span></span>
<span><span class="va">volcano</span> <span class="op">&lt;-</span> <span class="va">volcano</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/setExtent.html" class="external-link">setExtent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="va">volcano</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html" class="external-link">extent</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">qm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quadmesh.html">quadmesh</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span></code></pre></div>
<p>If you have the rgl package installed you can run the following code to produce an interactive plot.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmurdoch/rgl" class="external-link">rgl</a></span><span class="op">)</span></span>
<span><span class="va">scl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">shade3d</span><span class="op">(</span><span class="va">qm</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fu">scl</span><span class="op">(</span><span class="va">qm</span><span class="op">$</span><span class="va">vb</span><span class="op">[</span><span class="fl">3</span>,<span class="va">qm</span><span class="op">$</span><span class="va">ib</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#rglwidget()</span></span></code></pre></div>
<p>A “quadmesh” is a dense mesh describing a topologically continuous surface of 4-corner primitives. I.e. a grid, without the “regular”. This is useful particularly when combined with map projections and texture mapping.</p>
<p>We are not limited to a regular grid, trivially let’s distort the mesh by a weird scaling factor.</p>
<p>The topology of the grid is still sound, but we are no longer bound to the regular constraint.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quadmesh.html">quadmesh</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span></span>
<span><span class="va">qm1</span><span class="op">$</span><span class="va">vb</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">qm</span><span class="op">$</span><span class="va">vb</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="op">*</span> <span class="va">qm</span><span class="op">$</span><span class="va">vb</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span><span class="op">/</span><span class="fl">54</span></span></code></pre></div>
<p>If you have the rgl package installed you can run the following code to produce an interactive plot.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">open3d</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">shade3d</span><span class="op">(</span><span class="va">qm1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fu">scl</span><span class="op">(</span><span class="va">qm1</span><span class="op">$</span><span class="va">vb</span><span class="op">[</span><span class="fl">3</span>,<span class="va">qm1</span><span class="op">$</span><span class="va">ib</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#rglwidget()</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="why-quadmesh">Why quadmesh?<a class="anchor" aria-label="anchor" href="#why-quadmesh"></a>
</h2>
<p>Why meshes at all?</p>
<p>The simplest kind of mesh is a basic raster. Consider a matrix of 12 values.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">## [1,]    1    4    7   10</span></span>
<span><span class="co">## [2,]    2    5    8   11</span></span>
<span><span class="co">## [3,]    3    6    9   12</span></span></code></pre>
<p>On its own this matrix has absolutely nothing to do with spatial data, it is literally a collection of 12 numeric values in a given order, and by the magic of programming we’ve nominated a shape of 3x4. We can’t help but think about this shape spatially however, but there’s a problem. Does each element occupy space or should we consider them to be infinitesimal locations?</p>
<p>R provides either interpretation (to simplify this story we nominate locations for the rows and columns explicitly).</p>
<p>When considered as an image, each matrix element occupies a certain space in width and height, but when considered as a point set the numbers simply float at the given locations. Which is correct? (Spoiler: Both are correct, it simply depends what we are doing.)</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">m</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, lab <span class="op">=</span> <span class="va">m</span><span class="op">[</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="quadmesh_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>The raster package defaults to the image interpretation and helpfully assumes the values are nominally at the centre points as shown above. We have to nominate the extent or we end up in 0,1 range, we also have to invert the order of the values because raster counts from the top of the page and R’s matrix uses <a href="https://CRAN.R-project.org/package=reticulate/vignettes/arrays.html" class="external-link">column-major order</a>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, xmn <span class="op">=</span> <span class="fl">0</span>, xmx <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>, ymn <span class="op">=</span> <span class="fl">0</span>, ymx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## class      : RasterLayer </span></span>
<span><span class="co">## dimensions : 4, 3, 12  (nrow, ncol, ncell)</span></span>
<span><span class="co">## resolution : 1.333333, 0.75  (x, y)</span></span>
<span><span class="co">## extent     : 0, 4, 0, 3  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## crs        : NA </span></span>
<span><span class="co">## source     : memory</span></span>
<span><span class="co">## names      : layer </span></span>
<span><span class="co">## values     : 1, 12  (min, max)</span></span></code></pre>
<p>R’s image and rasters in general are so efficient because they only store this minimal amount of information: the actual data values, and the extent and dimensions of the space they occur in. If we had to store the centre coordinate of every cell, or worse the corner coordinates then the data storage goes up dramatically. Every software that deals well with these kinds of data has to treat these coordinates as implicit. We can easily expand the centre coordinates.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xyz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">r</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">xyz</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           x     y layer</span></span>
<span><span class="co">## 1 0.6666667 2.625    10</span></span>
<span><span class="co">## 2 2.0000000 2.625    11</span></span>
<span><span class="co">## 3 3.3333333 2.625    12</span></span>
<span><span class="co">## 4 0.6666667 1.875     7</span></span>
<span><span class="co">## 5 2.0000000 1.875     8</span></span>
<span><span class="co">## 6 3.3333333 1.875     9</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">xyz</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            x     y layer</span></span>
<span><span class="co">## 7  0.6666667 1.125     4</span></span>
<span><span class="co">## 8  2.0000000 1.125     5</span></span>
<span><span class="co">## 9  3.3333333 1.125     6</span></span>
<span><span class="co">## 10 0.6666667 0.375     1</span></span>
<span><span class="co">## 11 2.0000000 0.375     2</span></span>
<span><span class="co">## 12 3.3333333 0.375     3</span></span></code></pre>
<p>but to expand the corners we have to jump through some hoops and even then we get <em>every instance</em> of the corners, not only for each cell but to explicitly close the cell as a polygon.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">as</span><span class="op">(</span><span class="fu">as</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPolygons.html" class="external-link">rasterToPolygons</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>, <span class="st">"SpatialLinesDataFrame"</span><span class="op">)</span>, </span>
<span>   <span class="st">"SpatialPointsDataFrame"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## class       : SpatialPointsDataFrame </span></span>
<span><span class="co">## features    : 60 </span></span>
<span><span class="co">## extent      : 0, 4, 0, 3  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">## crs         : NA </span></span>
<span><span class="co">## variables   : 4</span></span>
<span><span class="co">## names       : layer, Lines.NR, Lines.ID, Line.NR </span></span>
<span><span class="co">## min values  :     1,        1,        1,       1 </span></span>
<span><span class="co">## max values  :    12,       12,        9,       1</span></span></code></pre>
<p>There are only 20 unique coordinates at the corners, which is where quadmesh comes in.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/quadmesh" class="external-link">quadmesh</a></span><span class="op">)</span></span>
<span><span class="va">qm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quadmesh.html">quadmesh</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">qm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 8</span></span>
<span><span class="co">##  $ vb             : num [1:4, 1:20] 0 3 11 1 1.33 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   .. ..$ : chr [1:4] "x" "y" "z" "1"</span></span>
<span><span class="co">##   .. ..$ : NULL</span></span>
<span><span class="co">##  $ material       : list()</span></span>
<span><span class="co">##  $ normals        : NULL</span></span>
<span><span class="co">##  $ texcoords      : NULL</span></span>
<span><span class="co">##  $ meshColor      : chr "vertices"</span></span>
<span><span class="co">##  $ ib             : int [1:4, 1:12] 1 2 6 5 2 3 7 6 3 4 ...</span></span>
<span><span class="co">##  $ raster_metadata:List of 7</span></span>
<span><span class="co">##   ..$ xmn  : num 0</span></span>
<span><span class="co">##   ..$ xmx  : num 4</span></span>
<span><span class="co">##   ..$ ymn  : num 0</span></span>
<span><span class="co">##   ..$ ymx  : num 3</span></span>
<span><span class="co">##   ..$ ncols: int 3</span></span>
<span><span class="co">##   ..$ nrows: int 4</span></span>
<span><span class="co">##   ..$ crs  : chr NA</span></span>
<span><span class="co">##  $ crs            : chr NA</span></span>
<span><span class="co">##  - attr(*, "class")= chr [1:3] "quadmesh" "mesh3d" "shape3d"</span></span></code></pre>
<p>This is a mysterious seeming data structure, it is the mesh3d type of the ‘rgl’ package, rarely seen in the wild.</p>
<p>The structure is <code>vb</code>, the coordinates of the mesh - these are the actual corner coordinates from the input raster.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>xpd <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">qm</span><span class="op">$</span><span class="va">vb</span><span class="op">)</span>, lab <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p><img src="quadmesh_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></span></code></pre></div>
<p>Notice how these are unique coordinates, there’s no simple relationship between the cell and its value and its four corners. This is because they are shared between neighbouring cells. The relationship is stored in the <code>ib</code> array, this has four rows one for each corner of each cell. There are 12 cells and each has four coordinates from the shared vertex pool. The cells are defined in the order they occur in raster.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qm</span><span class="op">$</span><span class="va">ib</span></span></code></pre></div>
<pre><code><span><span class="co">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12]</span></span>
<span><span class="co">## [1,]    1    2    3    5    6    7    9   10   11    13    14    15</span></span>
<span><span class="co">## [2,]    2    3    4    6    7    8   10   11   12    14    15    16</span></span>
<span><span class="co">## [3,]    6    7    8   10   11   12   14   15   16    18    19    20</span></span>
<span><span class="co">## [4,]    5    6    7    9   10   11   13   14   15    17    18    19</span></span></code></pre>
<p>It works directly with rgl function, and can be used in more raw form.</p>
<p>If you have the rgl package installed you can run the following code to produce an interactive plot.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rgl.clear</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dmurdoch/rgl" class="external-link">rgl</a></span><span class="op">)</span></span>
<span><span class="fu">shade3d</span><span class="op">(</span><span class="va">qm</span><span class="op">)</span></span>
<span><span class="fu">rglwidget</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">rgl.clear</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">quads3d</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">qm</span><span class="op">$</span><span class="va">vb</span><span class="op">)</span><span class="op">[</span><span class="va">qm</span><span class="op">$</span><span class="va">ib</span>,<span class="op">]</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"black"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">aspect3d</span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#rglwidget()</span></span></code></pre></div>
<p>The primary means to create this format from a raster is for 3D plotting, but because we have access to the coordinate directly it provides other uses. We can transform the coordinates (i.e. a map projection) or manipulate them and augment the Z value (for example) in flexible ways.</p>
<p>(The usual way of driving rgl grid surfaces is <code>rgl.surface</code> but this is limited to the centre-point interpretation only - more than the x, y, z list interface as image() is, i.e. it can take an individual x,y pair for every cell, but it cannot properly represent the cell-as-area as image can. For this we need to use <code>shade3d</code>, and actual <code>meshd3d</code> types in <code>rgl</code>).</p>
</div>
<div class="section level2">
<h2 id="triangle-mesh">Triangle mesh<a class="anchor" aria-label="anchor" href="#triangle-mesh"></a>
</h2>
<p>Alternatively the centre-of-cell interpretation of a raster is available.</p>
<p>If you have the rgl package installed you can run the following code to produce an interactive plot.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rgl.clear</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">wire3d</span><span class="op">(</span><span class="va">qm</span><span class="op">)</span></span>
<span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/triangmesh.html">triangmesh</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu">shade3d</span><span class="op">(</span><span class="va">tm</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"firebrick"</span>, <span class="st">"dodgerblue"</span>, <span class="st">"grey"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#rglwidget()</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="discrete-forms">Discrete forms<a class="anchor" aria-label="anchor" href="#discrete-forms"></a>
</h2>
<p>There is a discrete form for both quad and triangles meshes. See how each quad has a constant z-value.</p>
<p>If you have the rgl package installed you can run the following code to produce an interactive plot.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dqm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quadmesh.html">dquadmesh</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu">rgl.clear</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">shade3d</span><span class="op">(</span><span class="va">dqm</span><span class="op">)</span></span>
<span><span class="co">#rglwidget()</span></span></code></pre></div>
<p>When the centre-point interpretation of <em>triangles</em> are discrete we actually need to modify their vertices to see that they are separable.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dtm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/triangmesh.html">dtriangmesh</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="va">dtm</span><span class="op">$</span><span class="va">vb</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="va">dtm</span><span class="op">$</span><span class="va">vb</span><span class="op">[</span><span class="fl">3</span>, <span class="op">]</span>, <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<p>If you have the rgl package installed you can run the following code to produce an interactive plot.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rgl.clear</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">shade3d</span><span class="op">(</span><span class="va">dtm</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"firebrick"</span>, <span class="st">"dodgerblue"</span>, <span class="st">"grey"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#rglwidget()</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quadmesh-is-a-special-case">Quadmesh is a special case<a class="anchor" aria-label="anchor" href="#quadmesh-is-a-special-case"></a>
</h2>
<p>All quad meshes may be specified trivially as a triangular mesh, there’s a straightforward re-indexing from quads to triangles by splitting each set of four into two sets of three. If the quad mesh is regular there’s a literal ambiguity about the best choice (diagonal up, or down?) which leads us to the real value of a triangulated mesh. The triangle mesh may be denser or coarser depending on need, something that a regular grid cannot do. Mesh creation is a dark and difficult science, but has been formalized with a strong math basis in recent years. It’s still hard to do constrained polygon triangulation, and this lack probably drove the transition of topology GIS to modern SF GIS more than any other issue.</p>
<p>But, modern meshing is now very well established, but its use in open and free contexts is still relatively rare. (We can see this changing in Javascript and D3 in particular.)</p>
<p>Physical modellers, engineering construction, fluid hydrodynamics use these techniques in detail, but finite-element level model is rarely applied in GIS contexts.</p>
</div>
<div class="section level2">
<h2 id="topology-and-geometry-are-completely-separable">Topology and geometry are completely separable<a class="anchor" aria-label="anchor" href="#topology-and-geometry-are-completely-separable"></a>
</h2>
<p>Consider two kinds of meshes, a simple triangulation and a short piecewise line composed of segments. The triangles and segments both <em>fill space</em> in a particular way, they inhabit 2D and 1D topology in a way that is independent of the actual geometric space in use. We can flatten the triangles into a plane or lay the line segments each at right angles to each other without changing this topological relation, as a mesh the triangles will still have the same neighbours and and the line will still have the same segments in the same order. The geometry is specified by the vertices between these topological elements, and we may define these in x,y, in x,y,z or x,y,z,time - or in any <em>geometric</em> space we choose.</p>
<p><em>planar and rgl plots of meshes</em></p>
<p>The topology itself may need to be defined in a particular origin geometry, and for example the Delaunay triangulation for connecting planar x,y points gives a particular mesh - but once this is defined we can transform the original geometry (say it was UTM, zone 55 south) into a global Lambert Azimuthal Equal Area, or onto a geocentric shell with radius 637187m - the relationship between the primitives (triangles, edges) does not change. Not all geometries make sense for a given mesh, but with a mesh we are quite free to choose amongst many sensible alternatives, the primitives provide a straightforward interpolative space along with other physical properties might be assumed to vary. This is the basis of barycentric interpolation and simplistic linear interpolation with depth over time, for example.</p>
</div>
<div class="section level2">
<h2 id="geometry-is-purely-a-table-of-attributes">Geometry is purely a table of attributes<a class="anchor" aria-label="anchor" href="#geometry-is-purely-a-table-of-attributes"></a>
</h2>
<p>It’s the mesh indexing of how the primitives relate to a given geometry that matters, not the original (or particular) geometry in play. This means that if we triangulate in the local coordinate system but then map the mesh in a different one it will no longer “be Delaunay”.</p>
<p>This also opens up the idea that we can store multiple coordinate system choices in one data set.</p>
<p>There are efficiencies for different kinds of mesh, for raster we need only store the cell values and the offset and scale to position the grid. It’s completely parameterized, and if we need the centre or corner coordinates they are implicit, no need to generate them. If we store a connected triangular mesh, it becomes wasteful to store every path around each triangle as coordinates, and it’s actually error-prone because we need to update all instances of coordinates at any shared boundary. A better approach is to keep the index of each triangle, against a set of shared vertices. We can augment the vertices, transform them and so on and because they are uniquely defined the mesh is automatically correctly updated with no gaps.</p>
</div>
<div class="section level2">
<h2 id="point-clouds-are-pure-geometry">Point clouds are pure geometry<a class="anchor" aria-label="anchor" href="#point-clouds-are-pure-geometry"></a>
</h2>
<p>Point clouds provide a range of implicit shapes from set of raw geometry. There’s the “ground”, and some challenging algorithms exist to identify which points best represent this particular surface in a set of points. We can define this set of ground points <em>implicitly</em>, by storing a reference to the relevant vertices from the entire set. If we use this to actually <em>connect the points</em> together then we still store those indexes in triplets, the triangulation of those points in the X-Y plane. Notice how the points are connnected together in a nominated X-Y space, it doesn’t matter where the Z value/s are, they only contributed to the choice of ground points. There’s a chain of implicit, indexed structures that we can construct from these samples of raw geometry. Other algorithms might include the spectral properties or other measurements for the particular definition of the target surface.</p>
</div>
<div class="section level2">
<h2 id="polygons-and-lines-in-gis-are-piecewise-graphs">Polygons and lines in GIS are piecewise graphs<a class="anchor" aria-label="anchor" href="#polygons-and-lines-in-gis-are-piecewise-graphs"></a>
</h2>
<p>From the mesh perspective SF types are <em>explicitly described piecewise shapes. Every coordinate is stored explicitly as it occurs, but we can flip this view and rather store the entities involved (and </em>name them<em>) together. There are vertices and edges, and these are grouped into higher entities such as </em>paths<em>, and paths are grouped together as </em>lines or polygons*, and these are further grouped into features. By storing each element in its own set we have opportunity for explicit topology (shared vertices, shared edges).</p>
<p>We <em>lose</em> the ability to arbitrarily transmit atomic features around, but this can easily be achieved for a given set of features anyway.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
